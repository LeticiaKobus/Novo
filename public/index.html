<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Inu's Rings - Principal</title>
  </head>
  <body>
    <h1>Inu's Rings</h1>
    <div id="tokenInfo"></div>
    <script>
      // Função para obter o valor de um cookie pelo nome
      function getCookie(name) {
        const match = document.cookie.match(
          new RegExp("(^| )" + name + "=([^;]+)")
        );
        if (match) return match[2];
      }

      // Função para decodificar o token JWT e obter informações
      function decodeToken(token) {
        const base64Url = token.split(".")[1];
        const base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
        const jsonPayload = decodeURIComponent(
          atob(base64)
            .split("")
            .map(function (c) {
              return "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2);
            })
            .join("")
        );

        return JSON.parse(jsonPayload);
      }

      // Função para formatar o tempo restante em HH:MM:SS
      function formatTimeRemaining(expirationTime) {
        const now = new Date();
        const diffInSeconds = (expirationTime - now) / 1000; // Diferença em segundos

        const hours = Math.floor(diffInSeconds / 3600);
        const minutes = Math.floor((diffInSeconds % 3600) / 60);
        const seconds = Math.floor(diffInSeconds % 60);

        return `${hours}:${minutes}:${seconds}`;
      }

      // Função para atualizar dinamicamente o tempo restante
      function updateTimer() {
        const token = getCookie("token");

        if (token) {
          const decodedToken = decodeToken(token);
          const expirationTime = new Date(decodedToken.exp * 1000);

          const timeRemaining = formatTimeRemaining(expirationTime);

          document.getElementById("tokenInfo").innerHTML = `
          <p>Tempo restante para expiração do token: ${timeRemaining}</p>
        `;
        } else {
          document.getElementById("tokenInfo").innerHTML =
            "<p>Nenhum token encontrado.</p>";
        }
      }

      // Atualizar o timer a cada segundo
      setInterval(updateTimer, 1000);

      // Chamar updateTimer() inicialmente para exibir imediatamente
      updateTimer();
    </script>
  </body>
</html>
